(()=>{"use strict";var e={312:function(e,t,i){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(i(862)),n=document.getElementById("gfx");n.width=n.height=640,new s.default(n).start()},862:function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(s,n){function o(e){try{c(r.next(e))}catch(e){n(e)}}function a(e){try{c(r.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(i(660)),o=s(i(525)),a=new Float32Array([1,-1,0,-1,-1,0,0,1,0]),c=new Float32Array([1,0,0,0,1,0,0,0,1]),u=new Uint16Array([0,1,2]);t.default=class{constructor(e){this.render=()=>{this.colorTexture=this.context.getCurrentTexture(),this.colorTextureView=this.colorTexture.createView(),this.encodeCommands(),requestAnimationFrame(this.render)},this.canvas=e}start(){return r(this,void 0,void 0,(function*(){(yield this.initializeAPI())&&(this.resizeBackings(),yield this.initializeResources(),this.render())}))}initializeAPI(){return r(this,void 0,void 0,(function*(){try{const e=navigator.gpu;if(!e)return!1;this.adapter=yield e.requestAdapter(),this.device=yield this.adapter.requestDevice(),this.queue=this.device.queue}catch(e){return console.error(e),!1}return!0}))}initializeResources(){return r(this,void 0,void 0,(function*(){const e=(e,t)=>{let i={size:e.byteLength+3&-4,usage:t,mappedAtCreation:!0},r=this.device.createBuffer(i);return(e instanceof Uint16Array?new Uint16Array(r.getMappedRange()):new Float32Array(r.getMappedRange())).set(e),r.unmap(),r};this.positionBuffer=e(a,GPUBufferUsage.VERTEX),this.colorBuffer=e(c,GPUBufferUsage.VERTEX),this.indexBuffer=e(u,GPUBufferUsage.INDEX);const t={code:n.default};this.vertModule=this.device.createShaderModule(t);const i={code:o.default};this.fragModule=this.device.createShaderModule(i);const r={layout:this.device.createPipelineLayout({bindGroupLayouts:[]}),vertex:{module:this.vertModule,entryPoint:"main",buffers:[{attributes:[{shaderLocation:0,offset:0,format:"float32x3"}],arrayStride:12,stepMode:"vertex"},{attributes:[{shaderLocation:1,offset:0,format:"float32x3"}],arrayStride:12,stepMode:"vertex"}]},fragment:{module:this.fragModule,entryPoint:"main",targets:[{format:"bgra8unorm"}]},primitive:{frontFace:"cw",cullMode:"none",topology:"triangle-list"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus-stencil8"}};this.pipeline=this.device.createRenderPipeline(r)}))}resizeBackings(){if(!this.context){this.context=this.canvas.getContext("webgpu");const e={device:this.device,format:"bgra8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.context.configure(e)}const e={size:[this.canvas.width,this.canvas.height,1],dimension:"2d",format:"depth24plus-stencil8",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC};this.depthTexture=this.device.createTexture(e),this.depthTextureView=this.depthTexture.createView()}encodeCommands(){const e={colorAttachments:[{view:this.colorTextureView,loadValue:{r:0,g:0,b:0,a:1},storeOp:"store"}],depthStencilAttachment:{view:this.depthTextureView,depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:"load",stencilStoreOp:"store"}};this.commandEncoder=this.device.createCommandEncoder(),this.passEncoder=this.commandEncoder.beginRenderPass(e),this.passEncoder.setPipeline(this.pipeline),this.passEncoder.setViewport(0,0,this.canvas.width,this.canvas.height,0,1),this.passEncoder.setScissorRect(0,0,this.canvas.width,this.canvas.height),this.passEncoder.setVertexBuffer(0,this.positionBuffer),this.passEncoder.setVertexBuffer(1,this.colorBuffer),this.passEncoder.setIndexBuffer(this.indexBuffer,"uint16"),this.passEncoder.drawIndexed(3,1),this.passEncoder.endPass(),this.queue.submit([this.commandEncoder.finish()])}}},525:e=>{e.exports="[[stage(fragment)]]\nfn main([[location(0)]] inColor: vec3<f32>) -> [[location(0)]] vec4<f32> {\n    return vec4<f32>(inColor, 1.0);\n}\n"},660:e=>{e.exports="struct VSOut {\n    [[builtin(position)]] Position: vec4<f32>;\n    [[location(0)]] color: vec3<f32>;\n};\n\n[[stage(vertex)]]\nfn main([[location(0)]] inPos: vec3<f32>,\n        [[location(1)]] inColor: vec3<f32>) -> VSOut {\n    var vsOut: VSOut;\n    vsOut.Position = vec4<f32>(inPos, 1.0);\n    vsOut.color = inColor;\n    return vsOut;\n}"}},t={};!function i(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,i),n.exports}(312)})();